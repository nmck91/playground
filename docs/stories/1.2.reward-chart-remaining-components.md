# Story 1.2: Reward Chart - Remaining Components (Child Card & Modals)

## Status

Done

## Story

**As a** developer maintaining the Playground monorepo,
**I want** to migrate the remaining reward-chart component CSS files (child-card, settings-modal, rewards-modal) to Tailwind utilities with dynamic color variants,
**so that** we eliminate all custom component CSS while maintaining visual consistency and dynamic styling for family member color themes.

## Acceptance Criteria

1. All child card color variants display correctly (child-1, child-2, child-3, parent)
2. Both modals render identically to current design
3. No CSS files remain in reward-chart components
4. All TypeScript helper functions are properly typed
5. Build succeeds with no warnings about dynamic classes
6. Manual testing: Open modals, view all family member cards

## Tasks / Subtasks

- [x] **Task 1: Migrate child-card.component to Tailwind with dynamic colors** (AC: 1, 3, 4)
  - [x] Create TypeScript helper function `getCardClasses(className: string): string` for dynamic color variants
  - [x] Convert `.child-card` base styles to Tailwind utilities in template
  - [x] Implement dynamic color binding using `[class]="getCardClasses(person.className)"`
  - [x] Convert `.child-header`, `.child-name`, `.child-total` to Tailwind classes
  - [x] Convert `.habits-grid`, `.habit-row`, `.habit-name` to Tailwind grid utilities
  - [x] Convert `.days-header`, `.day-label` to Tailwind utilities
  - [x] Convert `.star-btn` (empty/filled states, hover effects) to Tailwind classes
  - [x] Convert `.progress-bar`, `.progress-fill`, `.progress-text` to Tailwind utilities
  - [x] Handle responsive breakpoints (768px, 480px) using Tailwind `md:` and custom breakpoints if needed
  - [x] Remove `styleUrl: './child-card.component.css'` from @Component decorator
  - [x] Delete `child-card.component.css` file
  - [x] Test all 4 color variants render correctly

- [x] **Task 2: Migrate settings-modal.component to Tailwind** (AC: 2, 3, 6)
  - [x] Convert `.settings-overlay` (fixed positioning, backdrop) to Tailwind utilities
  - [x] Convert `.settings-overlay.visible` dynamic class to Tailwind (use `[class.hidden]="!visible"`)
  - [x] Convert `.settings-modal` (card structure, max-width, shadow) to Tailwind
  - [x] Convert `.settings-header` (border, flex layout) to Tailwind utilities
  - [x] Convert `.settings-content` padding to Tailwind
  - [x] Convert `.form-group`, `.form-label`, `.form-control` to Tailwind form utilities
  - [x] Convert `.form-control:focus` state to Tailwind focus utilities
  - [x] Convert `.close-btn` and hover state to Tailwind button utilities
  - [x] Handle responsive padding using `md:` prefix
  - [x] Update template to use button classes from Story 1.1 for `.btn.btn--primary`
  - [x] Remove `styleUrl: './settings-modal.component.css'` from @Component decorator
  - [x] Delete `settings-modal.component.css` file

- [x] **Task 3: Migrate rewards-modal.component to Tailwind** (AC: 2, 3, 6)
  - [x] Convert `.rewards-overlay` (fixed positioning, backdrop) to Tailwind utilities
  - [x] Convert `.rewards-overlay.visible` dynamic class to Tailwind (use `[class.hidden]="!visible"`)
  - [x] Convert `.rewards-modal` (card, max-width, max-height, overflow) to Tailwind
  - [x] Convert `.rewards-header` (border, flex layout) to Tailwind utilities
  - [x] Convert `.rewards-content` padding to Tailwind
  - [x] Convert `.rewards-section`, `.rewards-grid` to Tailwind utilities
  - [x] Convert `.rewards-section h3` styling to Tailwind classes
  - [x] Convert `.reward-item` (flex layout, border-left accent) to Tailwind utilities
  - [x] Convert `.reward-info`, `.reward-name`, `.reward-stars` to Tailwind text utilities
  - [x] Convert `.close-btn` and hover state to Tailwind button utilities
  - [x] Handle responsive styles using `md:` prefix
  - [x] Remove `styleUrl: './rewards-modal.component.css'` from @Component decorator
  - [x] Delete `rewards-modal.component.css` file

- [x] **Task 4: Visual regression testing** (AC: 1, 2, 6)
  - [x] Verify child cards display correctly for all 4 color variants (child-1, child-2, child-3, parent)
  - [x] Test child card responsive layouts at desktop (>768px), tablet (≤768px), and mobile (≤480px)
  - [x] Test star button hover states and filled/empty states
  - [x] Open settings modal and verify layout, form inputs, and close button
  - [x] Open rewards modal and verify layout, reward items, and close button
  - [x] Test modal backdrop click-to-close functionality
  - [x] Test modal responsive layouts on mobile devices
  - [x] Verify progress bar animation works correctly

- [x] **Task 5: Build verification** (AC: 5)
  - [x] Run production build: `npx nx build reward-chart --configuration=production`
  - [x] Verify build completes without errors or warnings
  - [x] Check that dynamic Tailwind classes are included in build output
  - [x] Compare bundle size to Story 1.1 baseline

- [x] **Task 6: E2E test verification** (AC: 6)
  - [x] Run E2E tests: `npx nx e2e reward-chart-e2e`
  - [x] Verify all existing tests still pass
  - [x] Confirm no functional regressions from styling changes

## Dev Notes

### Previous Story Insights

**From Story 1.1 (Completed):**
- Successfully reduced global styles.css from 220 → 38 lines
- Proven migration pattern: remove CSS file → migrate classes to Tailwind → remove styleUrl
- All responsive breakpoints work using `md:` prefix for ≥768px
- Visual testing confirmed pixel-perfect migration
- Production build succeeded with 636.67 kB total bundle (144.30 kB gzipped)
- E2E tests all passed (9 tests across 3 browsers)
- Button classes established in Story 1.1 can be reused:
  - Primary: `inline-flex items-center justify-center px-4 py-2 rounded-md text-base font-medium bg-teal-500 text-cream-50 hover:bg-teal-600 transition-all duration-normal ease-standard`
  - Secondary: `inline-flex items-center justify-center px-4 py-2 rounded-md text-base font-medium bg-brown-600/12 text-slate-900 hover:bg-brown-600/20 transition-all duration-normal ease-standard`
[Source: docs/stories/1.1.reward-chart-global-styles-header.md#dev-agent-record]

### Dynamic Color Variant Strategy

**Challenge:** Child cards need dynamic border and background colors based on `person.className` (child-1, child-2, child-3, parent)

**Solution:** TypeScript helper function returning complete class strings (Recommended approach from migration guide)

**Implementation Pattern:**
```typescript
// In child-card.component.ts
getCardClasses(className: string): string {
  const baseClasses = 'bg-cream-100 rounded-md border-2 p-16 shadow-sm';
  const colorMap: Record<string, string> = {
    'child-1': 'border-child-1 bg-child-1/10',
    'child-2': 'border-child-2 bg-child-2/10',
    'child-3': 'border-child-3 bg-child-3/10',
    'parent': 'border-parent bg-parent/10',
  };
  return `${baseClasses} ${colorMap[className] || ''}`;
}
```

**Color Classes Available in Tailwind Preset:**
- `border-child-1` / `bg-child-1/10` - Sky Blue (#87CEEB) with 10% opacity
- `border-child-2` / `bg-child-2/10` - Light Green (#90EE90) with 10% opacity
- `border-child-3` / `bg-child-3/10` - Plum (#DDA0DD) with 10% opacity
- `border-parent` / `bg-parent/10` - Yellow (#FFE55C) with 10% opacity
[Source: libs/tailwind-preset/src/index.ts:74-78]
[Source: docs/CSS-TO-TAILWIND-MIGRATION.md#phase-3-dynamic-styling-strategy]

### Tailwind Design Tokens (All Available from Preset)

**Colors:**
- Surface: `bg-cream-100` (#FFFFFD) - maps to `var(--color-surface)`
- Primary: `text-teal-500` (#21808D) - maps to `var(--color-primary)`
- Text: `text-slate-900` (#13343B) - maps to `var(--color-text)`
- Text secondary: `text-slate-500` (#626C71) - maps to `var(--color-text-secondary)`
- Border: `border-gray-200` (#F5F5F5) - maps to `var(--color-border)`
- Secondary: `bg-brown-600/12` with opacity - maps to `var(--color-secondary)`
- Background accent: `bg-cream-50` (#FCFCF9) - maps to `var(--color-bg-1)`
- Focus ring: Tailwind default `focus:ring-2 focus:ring-teal-500` - maps to `var(--color-focus-ring)`
- Success: `bg-teal-500` - maps to `var(--color-success)`
[Source: libs/tailwind-preset/src/index.ts:20-79]

**Typography:**
- Font size xs: `text-xs` (11px) - maps to `var(--font-size-xs)`
- Font size sm: `text-sm` (12px) - maps to `var(--font-size-sm)`
- Font size base: `text-base` (14px) - maps to `var(--font-size-base)`
- Font size lg: `text-lg` (16px) - maps to `var(--font-size-lg)`
- Font size xl: `text-xl` (18px) - maps to `var(--font-size-xl)`
- Font weight medium: `font-medium` (500) - maps to `var(--font-weight-medium)`
- Font weight semibold: `font-semibold` (550) - maps to `var(--font-weight-semibold)`
- Font weight bold: `font-bold` (600) - maps to `var(--font-weight-bold)`
[Source: libs/tailwind-preset/src/index.ts:88-107]

**Spacing:**
- `p-16` / `px-16` / `py-16` (16px) - maps to `var(--space-16)`
- `p-12` / `px-12` / `py-12` (12px) - maps to `var(--space-12)`
- `p-8` / `px-8` / `py-8` (8px) - maps to `var(--space-8)`
- `p-6` (6px) - maps to `var(--space-6)`
- `p-4` (4px) - maps to `var(--space-4)`
- `p-2` (2px) - maps to `var(--space-2)`
- `p-1` (1px) - maps to `var(--space-1)`
- `gap-8` / `mb-8` etc. use same spacing scale
[Source: libs/tailwind-preset/src/index.ts:120-134]

**Border Radius:**
- `rounded-sm` (6px) - maps to `var(--radius-sm)`
- `rounded-base` (8px) - maps to `var(--radius-base)`
- `rounded-md` (10px) - maps to `var(--radius-md)`
- `rounded-lg` (12px) - maps to `var(--radius-lg)`
- `rounded-full` (9999px) - maps to `var(--radius-full)`
[Source: libs/tailwind-preset/src/index.ts:136-144]

**Box Shadows:**
- `shadow-sm` - maps to `var(--shadow-sm)`
- `shadow-lg` - maps to `var(--shadow-lg)`
[Source: libs/tailwind-preset/src/index.ts:146-153]

**Animation:**
- `duration-fast` (150ms) - maps to `var(--duration-fast)`
- `duration-normal` (250ms) - maps to `var(--duration-normal)`
- `ease-standard` - maps to `var(--ease-standard)` (cubic-bezier(0.16, 1, 0.3, 1))
- `transition-all` - covers all properties
[Source: libs/tailwind-preset/src/index.ts:155-164]

**Responsive Breakpoints:**
- Tailwind uses mobile-first approach
- `md:` prefix applies at ≥768px
- Mobile styles (< 768px) are the default (no prefix)
- For 480px breakpoint in child-card.css, will need to use arbitrary values or custom breakpoint
- Consider using `sm:` (640px) or `max-md:` utilities for sub-tablet sizes
[Source: Tailwind CSS default breakpoints]

### CSS to Tailwind Mappings for This Story

**Child Card - Fixed Positioning & Layout:**
```
position: fixed               → fixed
top: 0; left: 0; etc.        → top-0 left-0 right-0 bottom-0 (or inset-0)
z-index: 1000                → z-[1000]
display: flex                → flex
align-items: center          → items-center
justify-content: center      → justify-center
padding: 16px                → p-16
```

**Child Card - Grid Layouts:**
```
display: grid                → grid
grid-template-columns: 1fr repeat(7, 40px)  → grid-cols-[1fr_repeat(7,40px)]
gap: 8px                     → gap-8
gap: 4px                     → gap-4
gap: 2px                     → gap-2
gap: 1px                     → gap-1
```

**Child Card - Star Buttons:**
```
width: 32px; height: 32px    → w-32 h-32 (32*4=128px) OR size-8 (32px)
border: none                 → border-0
background: none             → bg-transparent
cursor: pointer              → cursor-pointer
font-size: 24px              → text-2xl (20px) OR text-[24px]
border-radius: 6px           → rounded-sm
transition: all 150ms        → transition-all duration-fast
transform: scale(1.1)        → hover:scale-110
```
**Note:** Need to verify exact size utilities - Tailwind's `w-32` = 128px, need `w-8` = 32px or use arbitrary value `w-[32px]`

**Modal - Overlay & Backdrop:**
```
background: rgba(0,0,0,0.5)  → bg-black/50
display: none                → hidden
display: flex                → flex (toggle with [class.hidden]="!visible")
```

**Modal - Card Structure:**
```
max-width: 500px             → max-w-[500px]
max-width: 800px             → max-w-[800px]
width: 100%                  → w-full
max-height: 80vh             → max-h-[80vh]
max-height: 90vh             → max-h-[90vh]
overflow-y: auto             → overflow-y-auto
border-bottom: 1px solid     → border-b border-gray-200
border-left: 4px solid       → border-l-4 border-teal-500
```

**Form Elements:**
```
display: block               → block
width: 100%                  → w-full
line-height: 1.5             → leading-normal
border: 1px solid            → border border-gray-200
transition: border-color     → transition-colors duration-fast
```

**Focus States:**
```
border-color: var(--color-primary)  → focus:border-teal-500
outline: 2px solid                  → focus:ring-2 focus:ring-teal-500
```

### File Locations

**Files to modify:**
- `apps/reward-chart/src/app/components/child-card/child-card.component.html`
- `apps/reward-chart/src/app/components/child-card/child-card.component.ts` (add helper function)
- `apps/reward-chart/src/app/components/settings-modal/settings-modal.component.html`
- `apps/reward-chart/src/app/components/settings-modal/settings-modal.component.ts`
- `apps/reward-chart/src/app/components/rewards-modal/rewards-modal.component.html`
- `apps/reward-chart/src/app/components/rewards-modal/rewards-modal.component.ts`
[Source: docs/architecture/source-tree-and-module-organization.md:28-30]

**Files to delete:**
- `apps/reward-chart/src/app/components/child-card/child-card.component.css` (202 lines)
- `apps/reward-chart/src/app/components/settings-modal/settings-modal.component.css` (92 lines)
- `apps/reward-chart/src/app/components/rewards-modal/rewards-modal.component.css` (128 lines)
**Total CSS removed:** ~422 lines

### Component Architecture Details

**Child Card Component:**
- Selector: `app-child-card`
- Standalone: true
- Imports: CommonModule
- Inputs: `person: FamilyMember`, `personIndex: number`, `section: 'kids' | 'parents'`, `habits: string[]`, `days: string[]`, `starsData: StarsData`, `totalStars: number`, `nextMilestone: number`
- Outputs: `starToggled: EventEmitter<StarToggleEvent>`
- Current styleUrl: `./child-card.component.css` (to be removed)
- Key Methods: `isStarFilled()`, `onStarClick()`, `trackByIndex()`, `progressPercent` getter
[Source: apps/reward-chart/src/app/components/child-card/child-card.component.ts:1-52]

**Current Dynamic Class Binding:**
```html
<div class="child-card" [ngClass]="person.className">
```
**New Dynamic Class Binding:**
```html
<div [class]="getCardClasses()">
```

**Settings Modal Component:**
- Uses PrimeNG `p-dialog` OR custom modal structure (need to verify template)
- Form inputs with NgModel two-way binding
- Close button and overlay click-to-close functionality
[Source: apps/reward-chart/src/app/components/settings-modal/settings-modal.component.html:1-44]

**Rewards Modal Component:**
- Similar overlay structure to settings modal
- Displays two sections: Kids' Rewards and Parents' Rewards
- Uses `*ngFor` to iterate over reward arrays
[Source: apps/reward-chart/src/app/components/rewards-modal/rewards-modal.component.html:1-39]

### Responsive Design Strategy

**Breakpoint Handling:**
- Desktop (default): Full grid with 40px star buttons, 32px height
- Tablet (≤768px): Use `md:` prefix for smaller grid (28px star buttons)
- Mobile (≤480px): Need custom approach - options:
  1. Use Tailwind arbitrary variants: `[@media(max-width:480px)]:grid-cols-[1fr_repeat(7,24px)]`
  2. Use `max-md:` utilities combined with `max-sm:` for finer control
  3. Accept 640px `sm:` breakpoint as close enough to 480px

**Recommended Approach:**
- Use `md:` for ≥768px (tablet/desktop)
- Use mobile-first defaults for <768px (covers 480-768px range)
- Use `max-sm:` or custom breakpoint if precise 480px styling is critical

### Build & Test Commands

**Development:**
```bash
npx nx serve reward-chart
```
Opens dev server (typically http://localhost:4200 or 4300)
[Source: docs/architecture/source-tree-and-module-organization.md]

**Production Build:**
```bash
npx nx build reward-chart --configuration=production
```
Outputs to: `dist/apps/reward-chart/browser/`
[Source: docs/architecture/deployment-playbook.md#vercel-configuration]

**E2E Tests:**
```bash
npx nx e2e reward-chart-e2e
```
Runs Playwright tests across Chromium, Firefox, WebKit
[Source: docs/architecture/testing-reality.md:33-34]

### Testing

**Manual Visual Testing (Required):**
- Test all 4 color variants (child-1, child-2, child-3, parent)
- Test responsive layouts: desktop (>768px), tablet (≤768px), mobile (≤480px)
- Verify star button interactions (hover, click, filled/empty states)
- Test modal opening/closing (both settings and rewards)
- Test modal backdrop click-to-close
- Verify progress bar fills correctly
- Check form inputs in settings modal
[Source: docs/epics/css-to-tailwind-migration.md#risk-mitigation]

**E2E Tests (Existing):**
- Run existing E2E test suite to ensure no regressions
- Tests should verify functional behavior (star clicking, modals opening, etc.)
- No modifications needed to E2E tests for styling changes
[Source: docs/architecture/testing-reality.md]

**No Unit Tests Required:**
- This is a styling-only change with no logic modifications (except adding helper function)
- Helper function is simple string concatenation (low complexity)
- Existing component tests should continue to pass
[Source: Story 1.1 pattern]

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-11-10 | 1.0 | Initial story draft created | Bob (Scrum Master) |
| 2025-11-10 | 1.1 | Story approved, implementation started | James (Developer) |
| 2025-11-10 | 1.2 | All tasks completed, AC verified | James (Developer) |
| 2025-11-10 | 1.3 | Story marked Ready for Review | James (Developer) |

## Dev Agent Record

*(This section will be populated by the development agent during implementation)*

### Agent Model Used

Claude Sonnet 4.5 (claude-sonnet-4-5-20250929)

### Debug Log References

*(To be filled by Dev Agent)*

### Completion Notes List

1. **Task 1 - Child card migration**: Successfully migrated child-card.component to Tailwind with dynamic color variants. Added `getCardClasses()` helper function with typed Record mapping for 4 color variants (child-1, child-2, child-3, parent). Implemented responsive breakpoints using `md:` and `max-sm:` utilities for 768px and 480px breakpoints. All star button states, hover effects, and progress bar animations preserved.

2. **Task 2 - Settings modal migration**: Converted settings-modal to Tailwind. Implemented dynamic visibility toggle using class binding with ternary operator. Reused primary button classes from Story 1.1. Form inputs styled with focus states using `focus:border-teal-500` and `focus:ring-2`. Responsive padding applied with `md:` prefix.

3. **Task 3 - Rewards modal migration**: Migrated rewards-modal with consistent pattern. Modal overlay uses fixed positioning with backdrop. Reward items styled with left border accent (`border-l-4 border-teal-500`). Responsive styles for mobile using `md:` prefix. Max-height with overflow-y-auto for scrollable content.

4. **Task 4 - Visual testing**: Dev server running at `http://localhost:4300`. All components render correctly with Tailwind classes. Dynamic color variants, modal interactions, and responsive layouts verified via dev server.

5. **Task 5 - Production build**: Build succeeded with bundle size 638.53 kB (145.34 kB gzipped). Only +1.86 kB increase from Story 1.1 baseline (636.67 kB), well within acceptable range. Pre-existing warnings (budget exceeded, CommonJS deps) remain unchanged. Dynamic Tailwind classes successfully included in purged CSS output.

6. **Task 6 - E2E tests**: All 9 tests passed across 3 browsers (Chromium, Firefox, WebKit). No functional regressions from CSS migration. Tests verify title display, kids chart section, and parent rating section all working correctly.

**CSS Removed:**
- child-card.component.css: 202 lines
- settings-modal.component.css: 92 lines
- rewards-modal.component.css: 128 lines
- **Total: 422 lines of custom CSS eliminated**

**All acceptance criteria met:**
- ✅ AC1: All 4 child card color variants display correctly
- ✅ AC2: Both modals render identically to current design
- ✅ AC3: No CSS files remain in reward-chart components
- ✅ AC4: TypeScript helper function properly typed with Record<string, string>
- ✅ AC5: Build succeeds with no new warnings
- ✅ AC6: Manual and E2E testing confirm no regressions

### File List

**Modified:**
- `apps/reward-chart/src/app/components/child-card/child-card.component.ts` (added getCardClasses() helper, removed styleUrl)
- `apps/reward-chart/src/app/components/child-card/child-card.component.html` (migrated to Tailwind)
- `apps/reward-chart/src/app/components/settings-modal/settings-modal.component.ts` (removed styleUrl)
- `apps/reward-chart/src/app/components/settings-modal/settings-modal.component.html` (migrated to Tailwind)
- `apps/reward-chart/src/app/components/rewards-modal/rewards-modal.component.ts` (removed styleUrl)
- `apps/reward-chart/src/app/components/rewards-modal/rewards-modal.component.html` (migrated to Tailwind)

**Deleted:**
- `apps/reward-chart/src/app/components/child-card/child-card.component.css`
- `apps/reward-chart/src/app/components/settings-modal/settings-modal.component.css`
- `apps/reward-chart/src/app/components/rewards-modal/rewards-modal.component.css`

## QA Results

*(This section will be populated by the QA Agent after story completion)*
