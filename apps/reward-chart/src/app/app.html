<div class="container" *ngIf="chartData$ | async as chartData">
  <app-header
    [weekDisplay]="weekDisplay"
    (showRewards)="onShowRewards()"
    (showSettings)="onShowSettings()"
    (newWeek)="onNewWeek()">
  </app-header>

  <!-- Kids Chart Section -->
  <div class="section">
    <div class="section-header">
      <h2>ğŸ‘¶ Kids' Chart</h2>
    </div>
    <div class="section-content">
      <div class="child-grid">
        <app-child-card
          *ngFor="let child of chartData.children; let i = index"
          [person]="child"
          [personIndex]="i"
          [section]="'kids'"
          [habits]="chartData.kidsHabits"
          [days]="chartData.days"
          [starsData]="chartData.kidsStars"
          [totalStars]="calculateTotalStars('kids', i)"
          [nextMilestone]="getNextMilestone(calculateTotalStars('kids', i), false)"
          (starToggled)="onStarToggled($event)">
        </app-child-card>
      </div>
    </div>
  </div>

  <!-- Parents Chart Section -->
  <div class="section">
    <div class="section-header">
      <h2>ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ Rate Mum & Dad!</h2>
      <button class="toggle-btn" (click)="toggleParentsSection()">ğŸ“Š</button>
    </div>
    <div class="section-content" [class.hidden]="!chartData.parentsVisible">
      <div class="child-grid">
        <app-child-card
          *ngFor="let parent of chartData.parents; let i = index"
          [person]="parent"
          [personIndex]="i"
          [section]="'parents'"
          [habits]="chartData.parentHabits"
          [days]="chartData.days"
          [starsData]="chartData.parentsStars"
          [totalStars]="calculateTotalStars('parents', i)"
          [nextMilestone]="getNextMilestone(calculateTotalStars('parents', i), true)"
          (starToggled)="onStarToggled($event)">
        </app-child-card>
      </div>
    </div>
  </div>

  <!-- Rewards Modal -->
  <app-rewards-modal
    [visible]="showRewardsModal"
    [kidsRewards]="chartData.kidsRewards"
    [parentsRewards]="chartData.parentsRewards"
    (close)="onCloseRewards()">
  </app-rewards-modal>

  <!-- Settings Modal -->
  <app-settings-modal
    [visible]="showSettingsModal"
    [childrenNames]="getChildrenNames(chartData)"
    (close)="onCloseSettings()"
    (save)="onSaveSettings($event)">
  </app-settings-modal>
</div>
