<div class="form-overlay" tabindex="0" role="button" aria-label="Close form" (click)="onCancel()" (keydown.enter)="onCancel()" (keydown.space)="onCancel()" (keydown.escape)="onCancel()"></div>
<div class="form-container" role="dialog" aria-modal="true" aria-labelledby="form-title" tabindex="0" (click)="$event.stopPropagation()" (keydown.escape)="onCancel()">
  <div class="form-header">
    <h2 id="form-title">{{ event ? 'Edit Event' : 'New Event' }}</h2>
    <button class="close-btn" (click)="onCancel()" aria-label="Close">&times;</button>
  </div>

  <form (ngSubmit)="onSubmit()" class="event-form">
    <div class="form-group">
      <label for="title">Event Title *</label>
      <input
        type="text"
        id="title"
        [value]="title()"
        (input)="title.set($any($event.target).value)"
        required
        placeholder="Enter event title"
      />
    </div>

    <div class="form-group">
      <label for="description">Description</label>
      <textarea
        id="description"
        [value]="description()"
        (input)="description.set($any($event.target).value)"
        rows="3"
        placeholder="Add details about the event"
      ></textarea>
    </div>

    <div class="form-row">
      <div class="form-group">
        <label for="category">Category *</label>
        <select
          id="category"
          [value]="category()"
          (change)="category.set($any($event.target).value)"
          required
        >
          <option *ngFor="let cat of categories" [value]="cat">
            {{ cat }}
          </option>
        </select>
      </div>

      <div class="form-group">
        <label for="location">Location</label>
        <input
          type="text"
          id="location"
          [value]="location()"
          (input)="location.set($any($event.target).value)"
          placeholder="Add location"
        />
      </div>
    </div>

    <div class="form-row">
      <div class="form-group">
        <label for="startDate">Start Date *</label>
        <input
          type="date"
          id="startDate"
          [value]="startDate()"
          (input)="startDate.set($any($event.target).value)"
          required
        />
      </div>

      <div class="form-group">
        <label for="startTime">Start Time *</label>
        <input
          type="time"
          id="startTime"
          [value]="startTime()"
          (input)="startTime.set($any($event.target).value)"
          required
        />
      </div>
    </div>

    <div class="form-row">
      <div class="form-group">
        <label for="endDate">End Date *</label>
        <input
          type="date"
          id="endDate"
          [value]="endDate()"
          (input)="endDate.set($any($event.target).value)"
          required
        />
      </div>

      <div class="form-group">
        <label for="endTime">End Time *</label>
        <input
          type="time"
          id="endTime"
          [value]="endTime()"
          (input)="endTime.set($any($event.target).value)"
          required
        />
      </div>
    </div>

    <div class="form-group">
      <label class="checkbox-label">
        <input
          type="checkbox"
          [checked]="isRecurring()"
          (change)="isRecurring.set($any($event.target).checked)"
        />
        <span>Recurring Event</span>
      </label>
    </div>

    <div *ngIf="isRecurring()" class="recurrence-options">
      <div class="form-row">
        <div class="form-group">
          <label for="frequency">Frequency</label>
          <select
            id="frequency"
            [value]="recurrenceFrequency()"
            (change)="recurrenceFrequency.set($any($event.target).value)"
          >
            <option *ngFor="let freq of frequencies" [value]="freq">
              {{ freq }}
            </option>
          </select>
        </div>

        <div class="form-group">
          <label for="interval">Repeat Every</label>
          <input
            type="number"
            id="interval"
            [value]="recurrenceInterval()"
            (input)="recurrenceInterval.set(+$any($event.target).value)"
            min="1"
            placeholder="1"
          />
        </div>
      </div>
    </div>

    <div class="form-actions">
      <button type="button" class="btn btn-secondary" (click)="onCancel()">
        Cancel
      </button>
      <button type="submit" class="btn btn-primary">
        {{ event ? 'Update' : 'Create' }} Event
      </button>
    </div>
  </form>
</div>
